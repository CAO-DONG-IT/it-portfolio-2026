# Subnetting / VLSM 学習ノート（Day13-15相当）

## 1. 前提（CIDRとサブネットの目的）
- **CIDR（/n）**は「ネットワーク部が先頭からnビット」という意味。
- サブネット化の目的は、1つの大きなネットワークを用途別に分割して、**アドレスを無駄なく配る**こと。

---

## 2. サブネットで最低限おさえる公式
### 2.1 ホスト数（使用可能アドレス数）
- **ホスト部ビット数 = 32 - プレフィックス長**
- **使用可能ホスト数 = 2^(ホスト部ビット数) - 2**
  - `-2` は **ネットワークアドレス** と **ブロードキャストアドレス** を除くため。

### 2.2 サブネットマスクの作り方（ざっくり）
- `/n` の「ネットワーク部」は **1**、ホスト部は **0** にして 32ビットを作る。
- 8ビット（1オクテット）ごとに10進数へ変換するとサブネットマスクになる。

---

## 3. 範囲を出す基本手順（ブロックサイズで解く）
「指定されたIPがどのサブネットに属するか」「Network/Broadcast/Usable」を出すときの流れ。

### 3.1 どのオクテットが境界かを決める
- /8, /16, /24 で割り切れない場合、境界は途中のオクテットに来る。
  - 例：/20 → 3rdオクテットが途中からネットワーク部に含まれる（=そこが計算対象）

### 3.2 ブロックサイズ（増分）を求める
- 計算対象オクテットのマスク値を `M` とすると  
  **ブロックサイズ = 256 - M**
- 例：/19 のマスクが `255.255.224.0` のとき  
  3rdオクテットは `224` → ブロックサイズ `256 - 224 = 32`

### 3.3 そのIPが入る区間（レンジ）を決める
- 0 からブロックサイズ刻みで並べる：`0, 32, 64, 96, 128, 160, 192, 224`
- 対象IPのオクテット値が **どの区間に入るか**を見る。
  - 例：3rdオクテットが `77` なら `64～95` の範囲。

### 3.4 Network / Broadcast / Usable
- **Network**：区間の先頭（例：64）
- **Next Network**：次の区間の先頭（例：96）
- **Broadcast**：Next Network の1つ前（例：95）
- **First Host**：Network + 1
- **Last Host**：Broadcast - 1
- 計算対象より右側のオクテットは
  - Network側：すべて `0`
  - Broadcast側：すべて `255`

---

## 4. よく出る確認ポイント
- `/25` は「/24 より 1ビット増えた」＝ **ホスト部が 8→7**  
  → 使用可能ホストは `2^7 - 2 = 126`
- `/28` はホスト部4ビット  
  → 1サブネットのアドレス総数 `2^4=16`、使用可能 `14`

---

## 5. VLSM（可変長サブネット）の考え方と手順
VLSMは、同じ/xxで固定せず、**必要ホスト数ごとに最適なプレフィックスを割り当てる**。

### 5.1 手順（これだけ守れば破綻しない）
1. **必要ホスト数を大きい順に並べる**
2. 各LAN/リンクに対して、必要ホスト数を満たす最小のプレフィックスを決める  
   - 目安：`2^h - 2 >= 必要ホスト数` を満たす **最小h**（=ホスト部ビット数）
3. 先頭のネットワーク（例：192.168.1.0/24）から、**大きいサブネットから順に**割り当てていく
4. それぞれで **Network / Broadcast / Usable** を確定し、次のサブネットは「直後のアドレス」から開始する
5. 最後に、割り当てが重複していないか、範囲が食い込んでいないか確認

### 5.2 典型例：ポイントツーポイント
- ルータ間リンクは必要ホストが少ない（通常2台）ため、/30（使用可能2）を使うことが多い。
  - ※要件によっては/31等もあるが、まずは/30の理解を優先。

---

## 6. 自分の解き方（ルール化）
- まず **必要ホスト数 → 必要ホスト部ビット数 → プレフィックス** の順で決める（VLSM）
- 範囲は **ブロックサイズ**でレンジを作って決める（Network/Broadcast）
- 迷ったら必ず：
  - 「次のネットワーク開始アドレス」を出して
  - 「その1つ前がBroadcast」を確認する
